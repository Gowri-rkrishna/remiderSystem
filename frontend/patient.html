<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Medicare Connect â€“ Patient Dashboard</title>
<link rel="stylesheet" href="style.css">
<meta http-equiv="Content-Security-Policy" content="default-src 'self'; connect-src 'self' http://127.0.0.1:5500; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; img-src 'self' data:">
</head>
<body>

<!-- Animated background -->
<div class="blob-extra"></div>
<div class="stars-layer" id="stars"></div>

<div class="container dashboard">

  <div class="dash-header">
    <div style="display:flex;align-items:center;gap:12px;">
      <div class="brand-icon">ðŸ’Š</div>
      <span class="dash-title">Patient Dashboard</span>
    </div>
    <span class="user-badge" id="userBadge">ðŸ‘¤ Patient</span>
  </div>

  <div class="patient-id-card" id="patientIdCard"></div>

  <div id="medList"></div>

  <button class="logout-btn" onclick="logout()">ðŸšª Logout</button>
</div>

<script src="script.js"></script>
<script>
  /* Stars */
  (function(){
    var s=document.getElementById('stars');
    for(var i=0;i<75;i++){
      var d=document.createElement('div');d.className='star';
      var sz=Math.random()*2.5+0.8;
      d.style.cssText='width:'+sz+'px;height:'+sz+'px;top:'+Math.random()*100+'%;left:'+Math.random()*100+'%;animation-delay:'+Math.random()*5+'s;animation-duration:'+(2+Math.random()*4)+'s;';
      s.appendChild(d);
    }
  })();

  /* Badge name */
  var cu = JSON.parse(localStorage.getItem("currentUser") || "{}");
  if (cu.name) document.getElementById("userBadge").innerText = "ðŸ‘¤ " + cu.name;

  /* Display Patient ID Card */
  if (cu.patientId) {
    var cardEl = document.getElementById("patientIdCard");
    cardEl.innerHTML = 
      '<div style="background: linear-gradient(135deg, #7c3aed 0%, #c084fc 100%); padding: 20px; border-radius: 12px; margin-bottom: 25px; box-shadow: 0 8px 32px rgba(124, 58, 237, 0.2); cursor: pointer;" onclick="copyPatientId()">' +
      '<div style="color: rgba(255,255,255,0.9); font-size: 12px; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; font-weight: 500;">ðŸªª Your Patient ID</div>' +
      '<div style="color: white; font-size: 24px; font-weight: 700; font-family: monospace; letter-spacing: 2px;">' + cu.patientId + '</div>' +
      '<div style="color: rgba(255,255,255,0.85); font-size: 12px; margin-top: 12px;">ðŸ“‹ Click to copy â€¢ Share with family members</div>' +
      '</div>';
  }

  function copyPatientId() {
    var cu = JSON.parse(localStorage.getItem("currentUser") || "{}");
    if (cu.patientId) {
      navigator.clipboard.writeText(cu.patientId).then(function() {
        alert("âœ… Patient ID copied to clipboard!");
      }).catch(function(err) {
        alert("Patient ID: " + cu.patientId);
      });
    }
  }

  /* Empty state fallback */
  var medListEl = document.getElementById("medList");
  if (medListEl && !medListEl.innerHTML.trim()) {
    var meds = JSON.parse(localStorage.getItem("meds") || "[]");
    var filtered = cu.patientId ? meds.filter(function(m){ return m.patientId === cu.patientId; }) : [];
    if (filtered.length === 0) {
      medListEl.innerHTML =
        '<div class="empty-state">' +
        '<div class="empty-icon">ðŸ’Š</div>' +
        '<p>No medicines added yet.<br>Ask your family member to add your medicines.</p>' +
        '</div>';
    }
  }

  function logout() {
    localStorage.removeItem("currentUser");
    localStorage.removeItem("autoLogin");
    window.location.href = "login.html";
  }
</script>
</body>
</html>